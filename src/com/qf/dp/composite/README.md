# 组合模式

组合模式属于对象的结构模式，有时又叫做“部分——整体”模式。合成模式将对象组织到树结构中，可以用来描述整体与部分的关系。组合可以使客户端将单纯元素与复合元素同等看待。

***

###### 组合模式的结构

这种形式涉及到三个角色：

* 抽象构件(Component)角色：这是一个抽象角色，它给参加组合的对象定义出公共的接口及其默认行为，可以用来管理所有的子对象。合成对象通常把它所包含的子对象当做类型为Component的对象。在安全式的合成模式里，构件角色并不定义出管理子对象的方法，这一定义由树枝构件对象给出。

* 树叶构件(Leaf)角色：树叶对象是没有下级子对象的对象，定义出参加组合的原始对象的行为。

* 树枝构件(Composite)角色：代表参加组合的有下级子对象的对象。树枝构件类给出所有的管理子对象的方法，如add()、remove()以及getChild()。

###### 使用场景

商品类别树

考虑这样一个实际的应用：管理商品类别树。

在实现跟商品有关的应用系统的时候，一个很常见的功能就是商品类别树的管理，比如有如下所示的商品类别树：

+服装

 +男装

    - 衬衣

    - 夹克

 +女装

    - 裙子

    - 套装

仔细观察上面的商品类别树，有以下几个明显的特点：

有一个根节点，比如服装，它没有父节点，它可以包含其它的节点
树枝节点，有一类节点可以包含其它的节点，称之为树枝节点，比如男装、女装
叶子节点，有一类节点没有子节点，称之为叶子节点，比如衬衣、夹克、裙子、套装

###### 组合模式的优缺点

定义了包含基本对象和组合对象的类层次结构

 在组合模式中，基本对象可以被组合成更复杂的组合对象，而组合对象又可以组合成更复杂的组合对象，可以不断地递归组合下去，从而构成一个统一的组合对象的类层次结构

统一了组合对象和叶子对象

在组合模式中，可以把叶子对象当作特殊的组合对象看待，为它们定义统一的父类，从而把组合对象和叶子对象的行为统一起来

简化了客户端调用

 组合模式通过统一组合对象和叶子对象，使得客户端在使用它们的时候，就不需要再去区分它们，客户不关心使用的到底是什么类型的对象，这就大大简化了客户端的使用

更容易扩展

由于客户端是统一的面对Component来操作，因此，新定义的Composite或Leaf子类能够很容易的与已有的结构一起工作，而客户端不需要为增添了新的组件类而改变

很难限制组合中的组件类型

容易增加新的组件也会带来一些问题，比如很难限制组合中的组件类型。这在需要检测组件类型的时候，使得我们不能依靠编译期的类型约束来完成，必须在运行期间动态检测。

